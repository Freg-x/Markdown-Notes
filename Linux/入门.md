[TOC]

### 0.0 这是啥

* 学习Linux的笔记，包含了基础入门操作，方便在复习时快速找到一些关键的知识。
* 参考书目为《Linux从入门到精通》，目前看下来精通应该是扯淡了，但作为入门快速了解一个领域效果还是很好的

* 虚拟机运行速度不是很理想，所以实验环境是Mac Big Sur



### 1.0 Shell基本命令

#### 1.1 进入目录 ```cd```

* ```~```代表当前用户的根目录

#### 1.2 显示当前目录```pwd```

#### 1.3 列出目录内容```ls```

* 可以使用```*.cpp```通配符代表任意长度匹配，```text?.txt```通配符代表单字母匹配，```text[1A][a-z]```代表方括号内匹配
* ```-F```可以显示后缀，更方便的区分文件类型
* ```-a```可以显示隐藏文件
* ```-l```可以显示文件的 读写权限/链接个数/所有者用户名/所有者所在组名/文件大小/最后一次修改的日期/文件名
* ```-ld```用于显示目录的 读写权限/链接个数/所有者用户名/所有者所在组名/文件大小/最后一次修改的日期/文件名

#### 1.4 *(只适用于Linux和Windows)* 列出目录内容```dir```，列出详细目录内容```vdir```

#### 1.5 只读查看 ```cat```

* ```-n```可以显示行号
* ```more```和```less```都是文本阅读工具，```Q```可以退出
  * 这些查看命令还有其他的用法但按下不表，因为在复杂的情况下建议直接上```vim```

#### 1.6 查找文件内容```grep```

* 用于直接查找文件中的某些内容并显示，支持正则表达式
* 目前看来单独使用的意义不大，后续有其他使用方法

#### 1.7 查找特定文件```find```

* 可以补充```type```、开始/结束时间等查找参数
* ```locate```命令同样可以用于查找，它基于一个预计算的数据库，所以查找速度更快
* 经实验上述两个查找命令在OSX下都不好用，建议实在找不到文件的使用采用finder

#### 1.8 后台运行程序```&```

```shell
firefox &
```

#### 1.9 查找特定程序 ```whereis```

* 在Mac内的适用范围很有限，大多只能找到```/usr/bin/```目录内的东西

#### 1.10 查看用户```who```和版本信息```uname```

* ```who```和```whoami```可以查看当前登陆的所有控制台/当前用户
* ```uname -a```可以查看当前系统的版本信息

#### 1.11 用户手册```man```

* ```man```加指令可以查看当前指令的使用方法
* 使用```Q```退出查看模式

#### 1.12 获取命令简介```whatis```和```apropos```



### 2.0 文件目录管理

#### 2.1 Linux文件系统结构

* 根目录下包含不同文件夹，大致内容如下：

|  目录  |           内容           |
| :----: | :----------------------: |
|  /bin  |      最常用的命令集      |
| /boot  |      内核与启动文件      |
|  /dev  |   device，各种设备文件   |
|  /etc  | 系统软件的启动和配置文件 |
| /home  |        用户主目录        |
|  /lib  |       C编译器的库        |
| /media |      媒体介质安装点      |
|  /opt  |   可选软件包（不常用）   |
| /proc  |        进程的映像        |
| /root  |      root用户主目录      |
| /sbin  |   和系统操作相关的命令   |
|  /tmp  |         临时文件         |
|  /usr  |    非系统的程序和命令    |
|  /var  |   系统用数据和配置文件   |

#### 2.2 团队文件相关

```shell
sudo groupadd workgroup ## 新建workgroup组

sudo useradd -G workgroup frege ##把frege加入workgroup组
sudo passwd frege ##为frege设置登录密码
```

```shell
sudo mkdir work ## 新建目录,所有权为root

sudo chgrp workgroup work/ ## 把work的所有组交给workgroup
sudo chown frege work/ ## 把work的所有权交给frege
```

#### 2.3 建立文件和目录

* ```mkdir```可以一次建立多个目录
* ```mkdir -p```可以递归的创建一组目录结构
* ```touch```可以建立一个空文件，同样可以用于更新一个文件的最后使用时间（在备份和整理文件时很好用）

#### 2.4 移动和重命名```mv```

* 使用```mv -i```可以给出提示信息，防止移动时覆盖
* 使用```mv -b```默认不覆盖，并在新文件后加一个```~```后缀

#### 2.5 复制文件和目录```cp```

* ```cp -i```可以给出提示信息，防止复制时覆盖
* ```cp -b```默认不覆盖，并在新文件后加一个```~```后缀
* ```cp -r test/ Desktop/```将递归的将目录及其中的文件复制到新位置

#### 2.6 删除目录和文件```rm```

* ```rmdir```只能删除空文件夹，一般没什么用
* ```rm -i```可以在删除时给出确认信息
* ```rm -f```代表force，不给出任何提示信息强行删除所有文件
* ```rm -r```代表递归删掉一个文件夹内的所有文件内容
* 注意```rm```的删除是不可逆的，不存在回收站的说法

#### 2.7 用户权限基础

* 同一个文件/目录对三种人有不同的权限，即文件所有者/所有者所在组和其他人，办理权限转移需要root用户进行操作
* 对于某一种权限组和某一个文件/目录，可以设置三种权限，读取(r)，写入(w)和执行(x)
* 对于文件，r位意味着可以打开并查看文件内容，w位意味着是否可以修改文件，x位只对可执行文件生效，代表是否可以执行文件。文件的移动/删除/重命名权限由其父目录的权限所控制
* 对于目录，r位代表了用户能否列出目录中的内容，w位代表了用户能否创建、删除、重命名文件，x位代表了用户能否进入该目录。
* 使用```ls -l```或```ls -ld```查看文件/目录的属性

#### 2.8 改变文件所有权```chown```

* ```sudo chown Frege:workgroup workfile```将把workfiile文件的所有者和所属组统一进行更改
* 可以单独使用```sudo chown Frege workfile```或```sudo chown :workgroup workfile```只更改所属用户或所属组
* 可以使用```sudo chown -R```递归更改文件夹及其内部所有文件的所有权
* ```chgrp```是```chown```的子集，但语意上更清晰

#### 2.9 改变文件权限```chmod```

* 使用方法一：对单类用户(u/g/o/a)的权限(rwx)进行增加或减少

  ```shell
  $ chmod u+x workfile
  $ chmod a-x workfile
  ```

* 使用方法二：直接赋予特定用户组权限

  ```shell
  $ chmod ug=rw, o=r workfile
  ```

* **使用方法三：**八进制表示文件权限

  ```shell
  $ chmod 777 workfile ## rwxrwxrwx
  $ chmod 711 workfile ## rwx--x--x
  $ chmod 755 workfile ## rwxr-xr-x
  ```

#### 2.10 Linux文件类型

* Linux内的一切都被表示为文件的形式，包括程序进程、硬件设备、通信通道甚至是内核数据结构

* 使用```ls -l```显示的第一个字符就是文件类型，Linux内有共计7种文件形式：

|                     文件类型                     | 符号 |          文件类型          | 符号 |
| :----------------------------------------------: | :--: | :------------------------: | :--: |
|                     普通文件                     |  -   | 本地域套接口（进程间通信） |  s   |
|                       目录                       |  d   |   有名管道（进程间通信）   |  p   |
|    字符设备文件（顺序访问设备，读取序列固定）    |  c   |  符号链接（类似快捷方式）  |  l   |
| 块设备文件（随机访问设备，可从任意位置随机读取） |  b   |                            |      |

#### 2.11 建立链接```ln```

* ```ln -s sourceFile linkFile```，通过这种语法可以建立一个软链接，访问linkFile就相当于访问sourceFile(Mac Big Sur内同样适用)
* 软链接同样适用于文件夹，删除链接文件对源文件没有影响，删除源文件后，链接文件失去意义
* ```ln sourceFile hardlinkFile```是一种创建硬链接文件的方式，这种情况下两个文件会被强制联系起来，修改同步，但目前已经很少有人实际使用硬链接了

#### 2.12 输出重定向```>/>>```

* 程序在默认情况下输出结果的地方被称作```stdout```，通常来说它指向显示器，而使用输出重定向可以把程序的输出转移到其他地方去
* ```ls > ~/Desktop/testDir/test.txt```，将清空原有文件的内容并显示```ls```的输出
* ```ls >> ~/Desktop/testDir/test.txt``` ，将在原有文件的末尾补充```ls```的输出
* ```<```为输入重定向，可以把文件作为指令的输入，但一般没啥用因为大部分命令都能以参数形式接收文件名，所以它经常被省略

#### 2.13 管道```|```

* 管道可以把一条指令的输出连接到另一条指令的输入：

  ```shell
  $ ls | grep -a
  $ ls | egrep '[a-z]*[1-9]'
  ```

  即先获取```ls```的输出再用正则表达式筛选，它在构造复杂高效的Shell指令时会很有用

### 3. 软件包管理

* 常用的软件包有两种，SUSE/Red Hat/Fedora等发行版本采用RPM，Debian和Ubuntu则采用.deb

#### 3.1 管理.deb软件包```dpkg```

* 这一节主要对应Debian和Ubuntu
* ```-i```是```--install```的缩写版，可以使用```dpkg -i```安装软件
* ```dpkg -l | grep openssh```会先查看安装的软件包集合，之后筛选包名中带openssh的
* ```dpkg -S openssh```将显示系统中有哪些文件是openssh带来的

* ```sudo dpkg -r opera```将会卸载opera软件，注意如果其他软件对卸载的文件有依赖将导致不可预计的后果，推荐使用后续介绍的高级包管理工具APT

#### 3.2 管理rpm软件包```rpm```

* 这一节主要对应Red Hat和OpenSUSE等
* ```sudo -ivh dump-0.4b41-1.src.rpm```是一条安装指令
  * ```-i```是安装指令
  * ```-v```将打印当前rpm执行的工作
  * ```-h```将打印一系列的```#```提醒用户安装进度
* ```sudo rpm -Uvh dump-0.4b41-1.src.rpm```将升级软件包。更新操作是卸载和安装的组合，如果原系统没有旧版本的软件包那么将直接请求安装新软件包
* ```rpm -q check```需要用户指明软件包的名字，rpm将给出它的版本信息
* ```rpm -qa | grep check```将列出已安装的所有软件包并使用grep进行筛选
* ```sudo rpm -e tcpdump```将卸载一个软件包，如果存在依赖，rpm会拒绝该操作
* ```sudo rpm -e -vv --test tcpdump```将模拟卸载一个软件包并打印完整的调试信息

#### 3.3 高级软件包工具APT

* APT全称Advanced Package Tool，是现今最成熟的软件包管理系统(Mac上使用brew代替)

* ```apt-get```用于执行软件包安装的所有操作，```apt-cache```用于查找软件包相关信息

  |         命令          |                 描述                 |
  | :-------------------: | :----------------------------------: |
  | ```apt-get update```  |    更新当前apt缓存中的软件包信息     |
  | ```apt-get install``` |           下载并安装软件包           |
  | ```apt-get upgrade``` | 下载并安装系统上已有软件包的最新版本 |
  | ```apt-get remove```  |            卸载特定软件包            |
  | ```apt-get source```  |         下载特定软件的源代码         |
  |  ```apt-get clean```  |        删除所有已下载的包文件        |

* ```apt-cache search flight```将搜索含有关键字的特定软件包

* ```apt-cache depends flightgear```将列出特定软件包的依赖关系

* ```/etc/apt/source.list```包含apt的安装源地址信息，可以对其进行修改或注释(即禁用)

#### 3.4 从源代码安装

* 有时候软件只有源代码形式，或者用户想要对源代码进行修改，或者想要修改软件安装的位置等，这个时候就需要从源代码进行安装
  1. 下载解压相关代码包
  2. (先行知识)linux上的所有软件都使用configure这个脚本来配置源代码形式发布的文件，configure将根据用户的参数生成makefile，引导用户使用make命令编译源代码
  3. ```./configure --prefix=/usr/local/games/foobillard```中的prefix必然用于指定安装位置，其他参数不定，需要根据README/INSTALL等文档进行决定
  4. ```make```将进行编译，```make install```将进行安装
  5. 剩余部分参考文档进行决定，可能需要下载一些依赖或者做一些字体/皮肤等文件的移动等

### 4.0 磁盘管理

#### 4.1 Linux文件系统

* Window下有NTFS和FAT两种文件系统，对于Linux：
  * ext4fs。对ext3fs的扩展和改善，增加日志功能，预留空间保存日志，并在灾难发生时利用日志快速恢复系统
  * Reiserfs。基本被ext4fs完爆，目前使用不多。
  * 

